(function(){var d={};var m=d.SpringSystem=function m(){this._springRegistry={};this._activeSprings=[];this._listeners=[];this._idleSpringIndices=[];this._boundFrameCallback=i(this._frameCallback,this)};h(m,{});h(m.prototype,{_springRegistry:null,_isIdle:true,_lastTimeMillis:-1,_activeSprings:null,_listeners:null,_idleSpringIndices:null,_frameCallback:function(){this.loop()},_frameCallbackId:null,createSpring:function(p,r){var o=new c(this);this.registerSpring(o);if(typeof p==="undefined"||typeof r==="undefined"){o.setSpringConfig(n.DEFAULT_ORIGAMI_SPRING_CONFIG)}else{var q=n.fromOrigamiTensionAndFriction(p,r);o.setSpringConfig(q)}return o},getIsIdle:function(){return this._isIdle},getSpringById:function(o){return this._springRegistry[o]},getAllSprings:function(){return Object.values(this._springRegistry)},registerSpring:function(o){this._springRegistry[o.getId()]=o},deregisterSpring:function(o){b(this._activeSprings,o);delete this._springRegistry[o.getId()]},advance:function(t,r){while(this._idleSpringIndices.length>0){this._idleSpringIndices.pop()}for(var s=0,p=this._activeSprings.length;s<p;s++){var q=this._activeSprings[s];if(q.systemShouldAdvance()){q.advance(t/1000,r/1000)}else{this._idleSpringIndices.push(this._activeSprings.indexOf(q))}}while(this._idleSpringIndices.length>0){var o=this._idleSpringIndices.pop();o>=0&&this._activeSprings.splice(o,1)}},loop:function(){var s;var r=Date.now();if(this._lastTimeMillis===-1){this._lastTimeMillis=r-1}var p=r-this._lastTimeMillis;this._lastTimeMillis=r;var q=0,o=this._listeners.length;for(q=0;q<o;q++){var s=this._listeners[q];s.onBeforeIntegrate&&s.onBeforeIntegrate(this)}this.advance(r,p);if(this._activeSprings.length===0){this._isIdle=true;this._lastTimeMillis=-1}for(q=0;q<o;q++){var s=this._listeners[q];s.onAfterIntegrate&&s.onAfterIntegrate(this)}e(this._frameCallbackId);if(!this._isIdle){this._frameCallbackId=g(this._boundFrameCallback)}},activateSpring:function(p){var o=this._springRegistry[p];if(this._activeSprings.indexOf(o)==-1){this._activeSprings.push(o)}if(this.getIsIdle()){this._isIdle=false;e(this._frameCallbackId);this._frameCallbackId=g(this._boundFrameCallback)}},addListener:function(o){this._listeners.push(o)},removeListener:function(o){b(this._listeners,o)},removeAllListeners:function(){this._listeners=[]}});var c=d.Spring=function c(o){this._id=c._ID++;this._springSystem=o;this._listeners=[];this._currentState=new a();this._previousState=new a();this._tempState=new a()};h(c,{_ID:0,MAX_DELTA_TIME_SEC:0.064,SOLVER_TIMESTEP_SEC:0.001});h(c.prototype,{_id:0,_springConfig:null,_overshootClampingEnabled:false,_currentState:null,_previousState:null,_tempState:null,_startValue:0,_endValue:0,_wasAtRest:true,_restSpeedThreshold:0.001,_displacementFromRestThreshold:0.001,_listeners:null,_timeAccumulator:0,_springSystem:null,destroy:function(){this._listeners=[];this._springSystem.deregisterSpring(this)},getId:function(){return this._id},setSpringConfig:function(o){this._springConfig=o;return this},getSpringConfig:function(){return this._springConfig},setCurrentValue:function(q){this._startValue=q;this._currentState.position=q;for(var p=0,o=this._listeners.length;p<o;p++){var r=this._listeners[p];r.onSpringUpdate&&r.onSpringUpdate(this)}return this},getStartValue:function(){return this._startValue},getCurrentValue:function(){return this._currentState.position},getCurrentDisplacementDistance:function(){return this.getDisplacementDistanceForState(this._currentState)},getDisplacementDistanceForState:function(o){return Math.abs(this._endValue-o.position)},setEndValue:function(p){if(this._endValue==p&&this.isAtRest()){return this}this._startValue=this.getCurrentValue();this._endValue=p;this._springSystem.activateSpring(this.getId());for(var q=0,o=this._listeners.length;q<o;q++){var r=this._listeners[q];r.onSpringEndStateChange&&r.onSpringEndStateChange(this)}return this},getEndValue:function(){return this._endValue},setVelocity:function(o){this._currentState.velocity=o;return this},getVelocity:function(){return this._currentState.velocity},setRestSpeedThreshold:function(o){this._restSpeedThreshold=o;return this},getRestSpeedThreshold:function(){return this._restSpeedThreshold},setRestDisplacementThreshold:function(o){this._displacementFromRestThreshold=o},getRestDisplacementThreshold:function(){return this._displacementFromRestThreshold},setOvershootClampingEnabled:function(o){this._overshootClampingEnabled=o;return this},isOvershootClampingEnabled:function(){return this._overshootClampingEnabled},isOvershooting:function(){return(this._startValue<this._endValue&&this.getCurrentValue()>this._endValue)||(this._startValue>this._endValue&&this.getCurrentValue()<this._endValue)},advance:function(v,x){var D=this.isAtRest();if(D&&this._wasAtRest){return}var s=x;if(x>c.MAX_DELTA_TIME_SEC){s=c.MAX_DELTA_TIME_SEC}this._timeAccumulator+=s;var z=this._springConfig.tension,u=this._springConfig.friction,L=this._currentState.position,A=this._currentState.velocity,I=this._tempState.position,E=this._tempState.velocity,p,J,C,M,o,r,B,w,K,F;while(this._timeAccumulator>=c.SOLVER_TIMESTEP_SEC){this._timeAccumulator-=c.SOLVER_TIMESTEP_SEC;if(this._timeAccumulator<c.SOLVER_TIMESTEP_SEC){this._previousState.position=L;this._previousState.velocity=A}p=A;J=(z*(this._endValue-I))-u*A;I=L+p*c.SOLVER_TIMESTEP_SEC*0.5;E=A+J*c.SOLVER_TIMESTEP_SEC*0.5;C=E;M=(z*(this._endValue-I))-u*E;I=L+C*c.SOLVER_TIMESTEP_SEC*0.5;E=A+M*c.SOLVER_TIMESTEP_SEC*0.5;o=E;r=(z*(this._endValue-I))-u*E;I=L+o*c.SOLVER_TIMESTEP_SEC*0.5;E=A+r*c.SOLVER_TIMESTEP_SEC*0.5;B=E;w=(z*(this._endValue-I))-u*E;K=1/6*(p+2*(C+o)+B);F=1/6*(J+2*(M+r)+w);L+=K*c.SOLVER_TIMESTEP_SEC;A+=F*c.SOLVER_TIMESTEP_SEC}this._tempState.position=I;this._tempState.velocity=E;this._currentState.position=L;this._currentState.velocity=A;if(this._timeAccumulator>0){this.interpolate(this._timeAccumulator/c.SOLVER_TIMESTEP_SEC)}if(this.isAtRest()||this._overshootClampingEnabled&&this.isOvershooting()){this._startValue=this._endValue;this._currentState.position=this._endValue;this.setVelocity(0);D=true}var q=false;if(this._wasAtRest){this._wasAtRest=false;q=true}var y=false;if(D){this._wasAtRest=true;y=true}for(var G=0,H=this._listeners.length;G<H;G++){var t=this._listeners[G];if(q){t.onSpringActivate&&t.onSpringActivate(this)}t.onSpringUpdate&&t.onSpringUpdate(this);if(y){t.onSpringAtRest&&t.onSpringAtRest(this)}}},systemShouldAdvance:function(){return !this.isAtRest()||!this.wasAtRest()},wasAtRest:function(){return this._wasAtRest},isAtRest:function(){return Math.abs(this._currentState.velocity)<this._restSpeedThreshold&&this.getDisplacementDistanceForState(this._currentState)<=this._displacementFromRestThreshold},setAtRest:function(){this._endValue=this._currentState.position;this._tempState.position=this._currentState.position;this._currentState.velocity=0;return this},interpolate:function(o){this._currentState.position=this._currentState.position*o+this._previousState.position*(1-o);this._currentState.velocity=this._currentState.velocity*o+this._previousState.velocity*(1-o)},addListener:function(o){this._listeners.push(o);return this},removeListener:function(o){b(this._listeners,o);return this},removeAllListeners:function(){this._listeners=[];return this},currentValueIsApproximately:function(o){return Math.abs(this.getCurrentValue()-o)<=this.getRestDisplacementThreshold()}});var a=function a(){};h(a.prototype,{position:0,velocity:0});var n=d.SpringConfig=function n(o,p){this.tension=o;this.friction=p};var j={tensionFromOrigamiValue:function(o){return(o-30)*3.62+194},origamiValueFromTension:function(o){return(o-194)/3.62+30},frictionFromOrigamiValue:function(o){return(o-8)*3+25},origamiFromFriction:function(o){return(o-25)/3+8}};h(n,{fromOrigamiTensionAndFriction:function(o,p){return new n(j.tensionFromOrigamiValue(o),j.frictionFromOrigamiValue(p))}});n.DEFAULT_ORIGAMI_SPRING_CONFIG=n.fromOrigamiTensionAndFriction(40,7);h(n.prototype,{friction:0,tension:0});var f=d.MathUtil={mapValueInRange:function(r,o,s,q,p){fromRangeSize=s-o;toRangeSize=p-q;valueScale=(r-o)/fromRangeSize;return q+(valueScale*toRangeSize)}};function b(q,p){var o=q.indexOf(p);o!=-1&&q.splice(o,1)}function e(o){return typeof window!="undefined"&&window.cancelAnimationFrame&&cancelAnimationFrame(o)}function g(p){var o;if(typeof process!="undefined"){o=setImmediate}else{o=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame}return o(p)}var k=Array.prototype.concat;var l=Array.prototype.slice;function i(p,o){args=l.call(arguments,2);return function(){p.apply(o,k.call(args,l.call(arguments)))}}function h(q,p){for(var o in p){if(p.hasOwnProperty(o)){q[o]=p[o]}}}if(typeof exports!="undefined"){h(exports,d)}else{if(typeof window!="undefined"){window.rebound=d}}})();